---
title: "L07 Strings & Regex"
subtitle: "Data Science 1 with R (STAT 301-1)"
author: "YOUR NAME"
pagetitle: "L07 YOUR NAME"
date: today

format:
  html:
    toc: true
    toc-depth: 4
    toc-location: left
    embed-resources: true
    code-fold: false
    link-external-newwindow: true

execute:
  warning: false

from: markdown+emoji
reference-location: margin
citation-location: margin  
---

::: {.callout-tip icon=false}

## Github Repo Link

To link to your github **repo**sitory, appropriately edit the example link below. Meaning replace `https://your-github-repo-url` with your github repo url. Suggest verifying the link works before submitting.

[https://your-github-repo-url](https://your-github-repo-url)

:::

## Overview

The goal of this lab is to learn and understand string manipulation in R. You’ll learn the basics of how strings work and how to create them by hand, but the focus of this chapter will be on regular expressions, or regexps for short (regex for even shorter). Regular expressions are useful because strings usually contain unstructured or semi-structured data, and regexps is a concise language for describing patterns in strings. You'd be surprised how often you'll need to use string manipulation in data science, whether for text analysis, efficiently loading data files/objects, or extracting information from the internet or standardized forms.

These resources may help:

* [`stringr` tidyverse homepage](http://stringr.tidyverse.org/articles/stringr.html)
* [regex tutorial](https://regexone.com/)
* [regex practice/game](https://regexcrossword.com/)

## Load packages

You should always begin by loading all necessary packages towards the beginning of your document.

```{r}
#| label: load-pkgs

# Loading package(s)

```

## Datasets 

All exercise datasets are found within downloaded R packages. New packages include `stringr` (part of `tidyverse`), `htmlwidgets`, and `stringi`.  

You'll also need the `instrument_reviews.csv`^[This dataset was sourced from [Kaggle](https://www.kaggle.com/datasets/eswarchandt/amazon-music-reviews/)] data file for the case study. The data and codebook is contained in the `data/` subdirectory.   

## Exercises

### Exercise 1 

Create strings that contain the following values:

1. `He said "That's amazing!"`

2. `\a\b\c\d`

3. `\\\\\\`

::: {.callout-tip icon="false"}
## Solution

YOUR SOLUTION HERE

:::

### Exercise 2

Compare and contrast the results of `paste0()` with `str_c()` for the following inputs:

```{r}
#| eval: false

str_c("hi ", NA)
str_c(letters[1:2], letters[1:3])
```
    
::: {.callout-tip icon="false"}
## Solution

YOUR SOLUTION HERE

:::

### Exercise 3

What's the difference between `paste()` and `paste0()`?
How can you recreate the equivalent of `paste()` with `str_c()`?

::: {.callout-tip icon="false"}
## Solution

YOUR SOLUTION HERE

:::

### Exercise 4

Use `str_length()` and `str_sub()` to extract the middle letter from each baby name, use data `babynames::babynames`. 

What will you do if the string has an even number of characters?

::: {.callout-tip icon="false"}
## Solution

YOUR SOLUTION HERE

:::

### Exercise 5

Using `babynames::babynames`, what baby name has the most vowels? What name has the highest proportion of vowels?

*Hint: what is the denominator?*

::: {.callout-tip icon="false"}
## Solution

YOUR SOLUTION HERE

:::

### Exercise 6

Create a regular expression that will match telephone numbers as commonly written in your country. Demonstrate a case when it matches and one where it doesn't match (an improper phone number).

::: {.callout-tip icon="false"}
## Solution

YOUR SOLUTION HERE

:::


### Exercise 7

Describe in words what these regular expressions match. 

*Hint: read carefully to see if each entry is a regular expression or a string that defines a regular expression.*

a.  `^.*$`
b.  `"\\{.+\\}"`
c.  `\d{4}-\d{2}-\d{2}`
d.  `"\\\\{4}"`
e.  `\..\..\..`
f.  `(.)\1\1`
g.  `"(..)\\1"`
    
::: {.callout-tip icon="false"}
## Solution

YOUR SOLUTION HERE

:::

### Exercise 8

The `stringr::words` vector contains a corpus amount of common words. The below code converts the vector into a tibble.

```{r}
words_df <- tibble(
  words = stringr::words  
)
```

Using the `words_df` data frame created above, create regular expressions that find all words that:

a.  Start with "y".
b.  Don't start with "y".
c.  End with "x".
d.  Are exactly three letters long. (Don't cheat by using `str_length()`!)
e.  Have seven letters or more.
f.  Contain a vowel-consonant pair.(ie: ab NOT ba)
g.  Contain at least two vowel-consonant pairs in a row.
h.  Only consist of repeated vowel-consonant pairs. (ie: even and animal are repeated vowel-consonant pairs but seven and animals are not)

::: {.callout-tip icon="false"}
## Solution

YOUR SOLUTION HERE

:::


### Exercise 9

For each of the following, you can use either a single regular expression or a combination of multiple `str_detect()` calls.

Using the `words_df` data frame created in the previous exercise...

a. Find all `words` that start or end with `x`.
b. Find all `words` that start with a vowel and end with a consonant.
c. Are there any `words` that contain at least one of each different vowel?

::: {.callout-tip icon="false"}
## Solution

YOUR SOLUTION HERE

:::


### Exercise 10

Construct patterns to find evidence for and against the rule "i before e except after c"?

::: {.callout-tip icon="false"}
## Solution

YOUR SOLUTION HERE

:::


## Case Study

::: {.callout-warning}

The work for this case study is not aimed at producing something for a boss. It is aimed at practicing working with strings. Therefore, providing and displaying code is expected. Raw tibble output is acceptable (meaning, you do not need to use `kable()` to make tables).

:::

Use the `instrument_reviews.csv` file in the `data` subdirectory to complete the tasks below.^[This dataset was sourced from [Kaggle](https://www.kaggle.com/datasets/eswarchandt/amazon-music-reviews/).]


### Task 1

Clean up the variable `reviewTime` by changing it into 3 **numeric** variables called `month`, `day`, and `year`. ie: the observation "02 28, 2014" would have a `month` of `2`; `day` of `28` and `year` of `2014`

Print a `glimpse()` of the dataset to prove you were successful.

::: {.callout-tip icon="false"}
## Solution

YOUR SOLUTION HERE

:::

### Task 2

Obtain a count of the number of reviews (`reviewText`) that mention the word “excellent” (case-insensitive) and the number that do not.


::: {.callout-tip icon="false"}
## Solution

YOUR SOLUTION HERE

:::


### Task 3

Convert the variable `helpful` into a `helpful_rating`. The first value is the number of people that found it helpful and the second value is the total number of people who voted. 

- [0, 0] should have a rating of 0 (not NA); 
- [13, 14] would have a rating of 13/14 = 0.929; 
- [1, 1] would have a rating of 1/1 = 1. 

Print only the variables `asin` ,`helpful` and `helpful_rating`.

*Hint: many ways to solve but consider using functions such as either `separate_wider_delim` or `str_extract` in combination with other `stringr` functions.*

::: {.callout-tip icon="false"}
## Solution

YOUR SOLUTION HERE

:::

## Graduate Challenge

::: callout-important

Graduate students are required to complete this challenge. **It is optional for undergraduate students.**

:::

Using the `instrument_reviews` dataset, create a new variable that contains either “excellent”, “good”, “amazing”, or NA. 

Use a single regex pattern to extract the **first** occurrence of any of the following words (“excellent”, “good”, “amazing”) from `reviewText`.

The variable should contain the first matching word (case-insensitive), or NA if none appear.

Examples: 

- "This is excellent and amazing." returns "excellent"
- "Good sound quality" returns "good"
- “Not worth the price” returns NA


